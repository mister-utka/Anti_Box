# Anti Box

Для статьи в журнале "Xakep"

### Проект демонстрирует:
1. возможность обнаружения песочниц;
2. обфускацию и шифрование в автоматизированном режиме;
3. маскировку зловредного payload-а от антивирусных решений.

### Задачи, которые были реализованы:
- у каждого исполняемого файла уникальная сигнатура как самого файла, так и его блоков;
- каждый char массив, который должен быть зашифрован, шифруется уникальным ключом;
- программа после отработки автоматически удаляется:
   - если обнаружила песочницу;
   - если отработал payload и установился reverse shell;
   - если было произведено 10 попыток подключения к серверу.

### Использование

В директории Box_Defautl лежит исходный код программы без обфускации.
В директории Box_Obfuscate лежит пример кода после обфускации.
В директории Obfuscator лежит py скрипт для обфускации.

Укажите нужный порт и ip адрес в файле Box_Default\\module\\reverse_shell.c
Запустите обфускатор:
```shell
cd Obfuscator
python3 obfuscator.py
```
В директории Box_Obfuscate появятся обновленные переобфуцированные исходники.
Компилируем исполняемый файл:
```shell
gcc .\\Box_Obfuscate\\main.c -o .\\Box_Obfuscate\\main.exe -s -fno-ident "-Wl,--dynamicbase,--nxcompat,--subsystem,windows"
```
-s	- удаляет всю отладочную информацию;

-fno-ident - не вставляет строку "Compiled by GCC" в секции .comment;

--nxcompat - включает защиту от исполнения данных (DEP);

-Wl,...	- передаёт параметры напрямую линковщику (ld);

--dynamicbase - включает ASLR (Address Space Layout Randomization) — защиту от эксплойтов, затрудняет предсказание адресов;

--subsystem,windows - говорит системе, что это GUI-приложение, а не консольное — отключает консоль при запуске.